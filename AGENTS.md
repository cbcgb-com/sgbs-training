# Notes for AI

Every change that you make in this repository MUST be self-coherent with
everything else that already exists. Before you make any changes, ensure that
you look at other relevant files and ensure that any changes you make do not
contradict anything else that is present. If what I am asking you to add is
self-contradictory, I want you to flag it to me. If what I'm requesting sounds
like it could be confusing for the intended audience of this repo's contents, I
want you to flag it to me as well. If you think we need to update AGENTS.md,
which contains instructions for you, to reflect new knowledge, I want you to
flag that to me.

## Intended Audience

The intended audience of this repo is Bible study leaders at our church, the
City Light church in Boston, which is tightly affiliated with the Chinese Bible
Church of Greater Boston. I consider the content of this repository to be
non-denominational; there should be no denomination-specific doctrines that are
espoused here. This content will get used as teaching material in Sunday school
classes. The number of class sessions is determined by the number of lessons
under `docs/class-notes/`. This Sunday school class aims to train new batches of
Bible study leaders in (a) how to study the Bible using the Inductive Bible
Study method, and (b) how to prep for and lead Bible study fellowship
gatherings. For (a), we primarily cover narrative and argumentative literary
styles, and generally avoid covering how to lead study for the revelatory and
poetic literary styles in the Bible.

## Content Style and Tone

All content should be written in Traditional Chinese (繁體中文) and maintain a
respectful, encouraging tone appropriate for Christian education. The writing
should be tailored for adult learners who are already committed to serving in
Bible study leadership roles. It's important to balance academic rigor with
practical accessibility, ensuring that the content is intellectually sound yet
approachable for learners at different stages of their journey. The language
should be inclusive, welcoming both new and experienced leaders without creating
barriers for those who are just beginning their service.

## Content Structure Standards

Clear learning objectives should be included at the beginning of each lesson
to help students understand what they will gain from the session. Homework
assignments should be specific and actionable, operating on an honor system
where students are trusted to complete readings and assignments without
instructor oversight. Discussion questions should use consistent formatting with
the ??? question format. Every lesson should include reflection and application
sections to help students connect the material to their own contexts. Content
should be designed to work both for live teaching and as standalone reference
material.

**Important**: Within any single markdown file, avoid duplicated content unless
it is present for deliberate emphasis. Each piece of information should appear
only once in its most appropriate location to maintain clarity and avoid
confusion.

## Cultural and Contextual Considerations

The content should consider the diverse backgrounds of Chinese students from
mainland China, Taiwan, Southeast Asia, and a growing contingent of North
American-born Mandarin speakers. We do not generally speak Cantonese at our
church, nor do we use Cantonese writing style. Writers should be sensitive to
different levels of biblical knowledge and church experience among students.
When discussing biblical passages, include relevant cultural context to help
students understand the historical and social background. Address potential
language barriers by providing clear explanations of theological terms and
concepts. Consider the practical challenges of leading Bible studies in
Chinese-speaking contexts, including the nuances of cross-cultural communication
and varying levels of familiarity with Christian terminology.

## Resource Integration

When referencing external resources such as books, websites, or videos, ensure
they are accessible to the target audience and always provide working URLs.
Prioritize Chinese-language resources when available to better serve the primary
audience. Include both free and paid resources, clearly indicating cost and
accessibility so students can make informed decisions about which resources to
pursue. Maintain up-to-date links and resource information to ensure the
materials remain useful over time. When recommending resources, consider their
theological perspective and flag any that are denominationally partisan, as the
audience consists of adults who can make their own judgment calls about
theological positions.

## Practical Application Standards

Every theoretical concept should include practical application examples that
help students understand how to implement what they've learned. Provide specific
scenarios that Bible study leaders might encounter in their actual ministry
contexts, including both positive examples of effective leadership and common
pitfalls to avoid. Ensure that all examples are relevant to small group Bible
study contexts rather than large group or classroom settings. Both individual
preparation skills and group facilitation skills are equally important, so
content should address both aspects of Bible study leadership.

## Quality Assurance Checklist

Before finalizing any content changes, verify:

- [ ] All Scripture references are accurate and properly formatted
- [ ] Chinese terminology is consistent throughout
- [ ] Learning objectives are clear and measurable
- [ ] Practical examples are relevant and helpful
- [ ] Content aligns with the inductive Bible study methodology
- [ ] No denominational bias is introduced
- [ ] Cultural sensitivity is maintained
- [ ] Cross-references to other lessons are accurate

## Technology and Tool Usage

When discussing GenAI or other technological tools, maintain a balanced
perspective where technology such as AI is used to enhance our capabilities
rather than take away our agency. Emphasize human-centered Bible study while
acknowledging helpful technological aids that can support the learning process.
Provide clear guidelines on appropriate versus inappropriate use of technology,
helping students understand when tools are helpful and when they might hinder
genuine engagement with Scripture. Include practical examples of how tools can
enhance but not replace personal study and reflection. Maintain transparency
about tool usage in content creation, modeling responsible and thoughtful use of
technology in educational contexts.

## Course Structure and Delivery

The course follows a flipped classroom approach where students are expected to
do readings beforehand, allowing class time to focus on interactive activities
and practical application. The materials serve dual purposes as both live
teaching resources and a long-term reference website that students can return to
after the course ends. The first 30 minutes of each class are typically
dedicated to mock Bible study and live activities that allow students to
practice what they've learned. Students prepare for each session using the class
notes under `docs/class-notes/`, ensuring they come to class ready to engage
with the material. The content should remain useful as a standalone reference
beyond the live course, providing ongoing value for students' future ministry.

## Assessment and Feedback Standards

Students must attend 4 out of 5 sessions, meaning they can only miss 1 class
to maintain course completion status. Homework operates on an honor system
where it is not checked by instructors; students are trusted to complete
readings and assignments on their own initiative. Feedback is primarily
peer-to-peer during in-class activities rather than instructor-given, fostering
a collaborative learning environment where students learn from each other's
experiences and insights. The course assumes that students have basic sound
instincts about what makes a good Bible study, building on their existing
knowledge and experience rather than starting from scratch. The focus is on
practical application and peer learning rather than formal evaluation,
emphasizing real-world skills over academic assessment.

## Homework Policy

Homework assignments are designed to prepare students for the next lesson's
content, not to reinforce the current lesson's material. This means:

- Homework always focuses on preparation for upcoming lessons
- We never assign homework that covers material already taught in the current
  lesson
- The final lesson (Lesson 5) will not have homework since there is no next
  lesson to prepare for
- This approach ensures students come to class ready to engage with new material
  rather than reviewing what was already covered

## Course Roles and Terminology

The course uses specific role terminology that should be consistently applied
throughout all lesson materials:

- **主領** (Leader): The person who leads the weekly mock Bible study
  discussion and facilitates the group
- **觀察員** (Observer): The person who observes the weekly mock Bible study
  session and provides feedback to the leader
- **其他人** (Others): All other participants in the weekly mock Bible study
  who are not in the leader or observer roles

These role terms should be used consistently in homework assignments, class
activities, and throughout all lesson notes to maintain clarity and consistency
for students.

## Content Formatting Standards

Avoid the formatting style that uses bold text followed by a colon and
description (e.g., `- **some text**: some more text.`). Instead, prefer:

1. **Bullet or numbered lists without prefix statements** - Use simple bullet
   points or numbered lists without bold introductory text
2. **Prose** - Write in flowing paragraph form when appropriate
3. **Tables** - Use tables to organize structured information clearly

This formatting approach creates cleaner, more readable content that is easier
to scan and understand.

## Bible Study Question Design Standards

When creating example Bible study questions, avoid using "why" questions as they
can be ambiguous and lead to unclear discussion directions. Instead, use more
specific question formats that guide participants toward clear thinking and
discussion. This principle is emphasized in lesson-3-questioning.md and should be
consistently applied across all example materials.

## Markdown Linting

All markdown files must be checked with markdownlint (the CLI tool) after
editing. Run `markdownlint filename.md` to check for issues and fix any
violations before committing changes. This ensures consistent formatting and
readability across all documentation.

**Installation**: If markdownlint is not installed, install it using:

```bash
pixi global install markdownlint-cli
```

**Important**: When markdownlint raises issues, fix ALL of them, not just the ones
introduced by your current changes. Even if the issues existed before your edits,
you should still fix them to maintain code quality and consistency. Always run
`markdownlint filename.md` on any markdown file you edit and address all
violations before considering the task complete.

## Notebook Usage

We use marimo notebooks going forward for interactive development and prototyping.
Do not edit existing .ipynb (Jupyter notebook) files in this repository, as they
are legacy files that should not be modified. If notebook functionality is needed,
create new marimo notebooks instead.

## Email Generator App Architecture

The email generator app is a FastAPI + HTMX + shadcn/ui application that generates
personalized homework emails for Bible study groups. Here are the key architectural
elements:

### Technology Stack

- **Backend**: FastAPI with Jinja2 templating
- **Frontend**: HTMX for dynamic interactions, Tailwind CSS for styling
- **UI Components**: shadcn/ui design system with custom CSS variables
- **Deployment**: Modal.com with pixi for dependency management
- **Authentication**: Google Drive API integration

### Core Application Structure

- **Entry Point**: `apps/api.py` - FastAPI application with route handlers
- **Legacy Entry Point**: `apps/app.py` - Panel-based interface (legacy)
- **Template**: `apps/templates/template.html` - Single-page HTMX application
- **Deployment**: `deployments/email_generator.py` - Modal deployment configuration

### Key Functional Components

#### 1. Route Handlers (`apps/api.py`)

- `GET /` - Serves the main HTMX interface
- `GET /{scripture}/{num_students}/{num_groups}` - Direct URL-based email
  generation
- `POST /form/scripture` - HTMX form submission handler
- `POST /validate/num_students` & `POST /validate/num_groups` - Real-time
  validation
- `GET /reinvitation-email` & `GET /homework-reminder-email` - Quick action
  endpoints

#### 2. Email Composition (`sgbs_training/email.py`)

- `get_lesson_info()` - Maps scripture names to lesson metadata
- `compose_homework_email()` - Main email composition with role-based
  assignments
- `compose_homework_email_legacy()` - Backward compatibility wrapper
- `compose_reinvitation_email()` & `compose_homework_reminder_email()` -
  Specialized emails

#### 3. Document Generation (`sgbs_training/docs.py`)

- `create_exercises()` - Creates Google Docs for questions and notes
- Integrates with Google Drive API for document creation and sharing
- Returns document metadata for email linking

#### 4. Exercise Templates (`sgbs_training/exercises.py`)

- `study_questions()` - Generates structured question templates
- `study_notes()` - Creates study note templates
- Supports multiple groups and students with role-based content

#### 5. Scripture Classes (`sgbs_training/scriptures.py`)

- Abstract `Scripture` base class with standardized methods
- Concrete implementations for Luke, John, Ephesians, James
- Provides lesson-specific resources, references, and instructions

### Frontend Architecture

- **Single Template**: `template.html` contains the entire application
- **HTMX Integration**: Real-time form validation and content updates
- **shadcn/ui Styling**: Custom CSS variables for consistent theming
- **Responsive Design**: Tailwind CSS with mobile-first approach
- **Loading States**: HTMX indicators for user feedback

### Data Flow

1. User selects scripture, number of students/groups
2. Form submission triggers `POST /form/scripture`
3. Backend calls `create_exercises()` to generate Google Docs
4. Email composition uses lesson metadata and document links
5. Markdown email content is rendered and returned to frontend
6. HTMX updates the preview area with generated content

### Authentication & External Services

- **Google Drive API**: Service account authentication for document creation
- **Modal Secrets**: Environment variables managed through Modal's secret system
- **Credential Management**: `sgbs_training/authentication.py` handles Google API
  credentials

### Deployment Configuration

- **Modal Image**: Debian-based with pixi package manager
- **Dependencies**: Managed through `pyproject.toml` with pixi features
- **Port Configuration**: Runs on port 5006 with 120s startup timeout
- **CI/CD**: Automatic deployment on PR branches and main branch pushes
